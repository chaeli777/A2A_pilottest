# 📧 이메일 자동 전송 설정 가이드

Reporter Agent가 최종 보고서를 자동으로 이메일로 전송하도록 설정하는 방법입니다.

## ✅ 준비물

- **Gmail 계정** (기존 계정 사용 가능)
- **5분** (최초 설정 시간)

## 🔧 설정 단계

### 1단계: Gmail 2단계 인증 활성화

1. [Google 계정 보안 설정](https://myaccount.google.com/security)으로 이동
2. "Google에 로그인" 섹션에서 **"2단계 인증"** 클릭
3. 안내에 따라 2단계 인증 활성화

> ⚠️ 2단계 인증 없이는 앱 비밀번호를 생성할 수 없습니다.

---

### 2단계: Gmail 앱 비밀번호 생성

1. [앱 비밀번호 페이지](https://myaccount.google.com/apppasswords)로 이동
   - 또는 Google 계정 → 보안 → 앱 비밀번호
2. "앱 선택" → **메일**
3. "기기 선택" → **Windows 컴퓨터**
4. **"생성"** 클릭
5. 화면에 표시된 **16자리 비밀번호** 복사
   - 예시: `abcd efgh ijkl mnop`
   - 공백은 나중에 제거하고 입력: `abcdefghijklmnop`

> 💡 이 비밀번호는 한 번만 표시되므로 바로 복사하세요!

📚 자세한 가이드: https://support.google.com/accounts/answer/185833

---

### 3단계: 환경변수 설정

Windows PowerShell을 열고 다음 명령어를 실행하세요:

```powershell
# 1. 발신자 Gmail 계정
$env:GMAIL_USER = "your-email@gmail.com"

# 2. 앱 비밀번호 (공백 제거)
$env:GMAIL_APP_PASSWORD = "abcdefghijklmnop"

# 3. 수신자 이메일 (보고서를 받을 사람)
$env:REPORT_RECIPIENT_EMAIL = "recipient@example.com"
```

> 💡 **본인에게 보내기**: 발신자와 수신자를 같은 이메일로 설정해도 됩니다!

---

### 4단계: 환경변수 확인

```powershell
# 설정이 잘 되었는지 확인
echo $env:GMAIL_USER
echo $env:GMAIL_APP_PASSWORD
echo $env:REPORT_RECIPIENT_EMAIL
```

각 명령어 실행 시 설정한 값이 표시되면 성공입니다!

---

## 🚀 실행 및 테스트

### 전체 파이프라인 실행 (이메일 자동 전송)

```bash
python examples/adk_with_gemini.py
```

환경변수가 올바르게 설정되어 있으면:
1. Research → Write → Review → Revise 실행
2. 파일 저장 (Markdown + HTML)
3. **📧 이메일 자동 전송**
4. 수신자의 받은 편지함에 보고서 도착!

---

### 이메일만 테스트하기

```python
from examples.adk_with_gemini import GeminiReporterAgent

reporter = GeminiReporterAgent()

result = reporter.execute_skill(
    "send_email",
    content="테스트 보고서 내용입니다.",
    to_email="your-email@example.com",
    subject="테스트 - A2A 보고서"
)

print(result)
```

---

## 📧 이메일 형식

Reporter Agent가 보내는 이메일은 다음과 같은 특징이 있습니다:

✅ **HTML 형식** - 깔끔하고 읽기 쉬운 디자인  
✅ **일반 텍스트 대체** - 이메일 클라이언트 호환성  
✅ **자동 타임스탬프** - 생성 일시 포함  
✅ **한글 완벽 지원** - UTF-8 인코딩  

**이메일 본문 예시:**
```
제목: [A2A 보고서] 매일 먹는 떡볶이가 우리 몸에 미치는 영향

╔════════════════════════════════════════════════════════════════╗
║               A2A Multi-Agent System Report                     ║
╚════════════════════════════════════════════════════════════════╝

📋 보고서 정보
• 생성 일시: 2024년 10월 26일 14:30:25
• 원본 질의: 매일 먹는 떡볶이가 우리 몸에 미치는 영향
• 참여 에이전트: 4개 (Research, Writer, Reviewer, Reporter)

📝 요약
[AI 생성 요약]

📄 최종 콘텐츠
[수정된 최종 보고서]

─────────────────────────────────────────────────────────────────
Generated by A2A Multi-Agent System
```

---

## 🔄 영구 설정 (선택사항)

PowerShell을 닫으면 환경변수가 사라집니다. **영구 설정**하려면:

### 방법 1: 시스템 환경변수 (권장)

1. **Windows 검색** → "환경 변수" 입력
2. **"시스템 환경 변수 편집"** 클릭
3. **"환경 변수"** 버튼 클릭
4. 사용자 변수에서 **"새로 만들기"** 클릭
5. 다음 3개 추가:
   - `GMAIL_USER` = `your-email@gmail.com`
   - `GMAIL_APP_PASSWORD` = `your-password`
   - `REPORT_RECIPIENT_EMAIL` = `recipient@example.com`

### 방법 2: .env 파일 사용

`env_template.txt`를 참고하여 `.env` 파일 생성:

```bash
# .env 파일
GMAIL_USER=your-email@gmail.com
GMAIL_APP_PASSWORD=abcdefghijklmnop
REPORT_RECIPIENT_EMAIL=recipient@example.com
```

그런 다음 `python-dotenv` 패키지 사용 (이미 설치됨):
```python
from dotenv import load_dotenv
load_dotenv()
```

---

## 🛠️ 문제 해결

### Q1: "Gmail 인증 정보가 없습니다" 오류

**원인:** 환경변수가 설정되지 않았거나 PowerShell을 재시작함

**해결:**
```powershell
# 환경변수 확인
echo $env:GMAIL_USER
echo $env:GMAIL_APP_PASSWORD

# 값이 없으면 다시 설정
$env:GMAIL_USER = "your-email@gmail.com"
$env:GMAIL_APP_PASSWORD = "your-password"
```

---

### Q2: "Authentication failed" 오류

**원인:** 
- 잘못된 앱 비밀번호
- 2단계 인증이 활성화되지 않음
- 일반 Gmail 비밀번호를 사용함 (❌)

**해결:**
1. 앱 비밀번호를 **다시 생성**하세요
2. 공백 없이 **16자리 모두** 입력했는지 확인
3. 일반 Gmail 비밀번호가 아닌 **앱 비밀번호** 사용

---

### Q3: "SMTPServerDisconnected" 오류

**원인:** 네트워크 또는 방화벽 문제

**해결:**
1. 인터넷 연결 확인
2. 방화벽에서 `smtp.gmail.com:465` 허용
3. VPN 사용 시 일시적으로 해제 후 테스트

---

### Q4: 이메일이 스팸함에 도착함

**해결:**
1. 받은 편지함에서 "스팸 아님" 표시
2. 발신자를 연락처에 추가
3. 다음 이메일부터는 받은 편지함에 도착

---

## 🎯 활용 팁

### 1. 여러 명에게 동시 전송

```python
recipients = ["person1@example.com", "person2@example.com", "person3@example.com"]

for recipient in recipients:
    reporter.execute_skill(
        "send_email",
        content=final_report,
        to_email=recipient,
        subject="주간 AI 보고서"
    )
```

### 2. 스케줄링 (자동화)

Windows 작업 스케줄러와 결합하여 매일 아침 자동 실행:
```powershell
# 작업 스케줄러 등록
schtasks /create /tn "AI_Daily_Report" /tr "python C:\path\to\adk_with_gemini.py" /sc daily /st 09:00
```

### 3. 조건부 전송

특정 조건에서만 이메일 전송:
```python
# 예: 보고서가 1000자 이상일 때만 전송
if len(final_report) > 1000:
    reporter.execute_skill("send_email", content=final_report, to_email="...")
```

---

## 📊 비용

- **Gmail SMTP**: **완전 무료** ✅
- **전송 제한**: 하루 500통 (Gmail 정책)
- **첨부파일**: 25MB까지 가능
- **API 키 불필요**: Gmail 계정만 있으면 됨

---

## 🔒 보안 주의사항

1. **앱 비밀번호는 절대 공유하지 마세요**
2. Git에 `.env` 파일을 올리지 마세요 (`.gitignore` 추가)
3. 코드에 직접 비밀번호를 입력하지 마세요
4. 앱 비밀번호는 정기적으로 재생성하세요

```bash
# .gitignore에 추가
.env
*.env
```

---

## 🆚 다른 이메일 서비스는?

Gmail 외에도 SMTP를 지원하는 다른 서비스를 사용할 수 있습니다:

### Outlook/Hotmail
```python
# smtp.gmail.com → smtp-mail.outlook.com
# 포트 587 사용 (465 대신)
```

### Naver Mail
```python
# smtp.gmail.com → smtp.naver.com
# 포트 587 사용
```

코드 수정이 필요하므로 **Gmail 사용을 권장**합니다.

---

## ✅ 최종 체크리스트

- [ ] Gmail 2단계 인증 활성화
- [ ] 앱 비밀번호 생성 (16자리)
- [ ] 환경변수 3개 설정 (`GMAIL_USER`, `GMAIL_APP_PASSWORD`, `REPORT_RECIPIENT_EMAIL`)
- [ ] 환경변수 확인 (`echo $env:...`)
- [ ] 테스트 실행 (`python examples/adk_with_gemini.py`)
- [ ] 받은 편지함 확인

---

**모든 준비가 완료되었습니다!** 🎉

이제 파이프라인을 실행하면 최종 보고서가 자동으로 이메일로 전송됩니다.

```bash
python examples/adk_with_gemini.py
```

문의사항이 있으면 `REPORTER_GUIDE.md`를 참고하세요.

